(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["WATCH"],{"18eb":function(e,t,r){"use strict";var a=r("c92b"),o=r.n(a);o.a},"27ae":function(module,exports,__webpack_require__){(function(global){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;(function(e,t){module.exports=t(e)})("undefined"!==typeof self?self:"undefined"!==typeof window?window:"undefined"!==typeof global?global:this,function(global){"use strict";global=global||{};var _Base64=global.Base64,version="2.5.1",buffer;if(module.exports)try{buffer=eval("require('buffer').Buffer")}catch(err){buffer=void 0}var b64chars="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",b64tab=function(e){for(var t={},r=0,a=e.length;r<a;r++)t[e.charAt(r)]=r;return t}(b64chars),fromCharCode=String.fromCharCode,cb_utob=function(e){if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?fromCharCode(192|t>>>6)+fromCharCode(128|63&t):fromCharCode(224|t>>>12&15)+fromCharCode(128|t>>>6&63)+fromCharCode(128|63&t)}t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return fromCharCode(240|t>>>18&7)+fromCharCode(128|t>>>12&63)+fromCharCode(128|t>>>6&63)+fromCharCode(128|63&t)},re_utob=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,utob=function(e){return e.replace(re_utob,cb_utob)},cb_encode=function(e){var t=[0,2,1][e.length%3],r=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0),a=[b64chars.charAt(r>>>18),b64chars.charAt(r>>>12&63),t>=2?"=":b64chars.charAt(r>>>6&63),t>=1?"=":b64chars.charAt(63&r)];return a.join("")},btoa=global.btoa?function(e){return global.btoa(e)}:function(e){return e.replace(/[\s\S]{1,3}/g,cb_encode)},_encode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(e){return(e.constructor===buffer.constructor?e:buffer.from(e)).toString("base64")}:function(e){return(e.constructor===buffer.constructor?e:new buffer(e)).toString("base64")}:function(e){return btoa(utob(e))},encode=function(e,t){return t?_encode(String(e)).replace(/[+\/]/g,function(e){return"+"==e?"-":"_"}).replace(/=/g,""):_encode(String(e))},encodeURI=function(e){return encode(e,!0)},re_btou=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),cb_btou=function(e){switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),r=t-65536;return fromCharCode(55296+(r>>>10))+fromCharCode(56320+(1023&r));case 3:return fromCharCode((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return fromCharCode((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},btou=function(e){return e.replace(re_btou,cb_btou)},cb_decode=function(e){var t=e.length,r=t%4,a=(t>0?b64tab[e.charAt(0)]<<18:0)|(t>1?b64tab[e.charAt(1)]<<12:0)|(t>2?b64tab[e.charAt(2)]<<6:0)|(t>3?b64tab[e.charAt(3)]:0),o=[fromCharCode(a>>>16),fromCharCode(a>>>8&255),fromCharCode(255&a)];return o.length-=[0,0,2,1][r],o.join("")},_atob=global.atob?function(e){return global.atob(e)}:function(e){return e.replace(/\S{1,4}/g,cb_decode)},atob=function(e){return _atob(String(e).replace(/[^A-Za-z0-9\+\/]/g,""))},_decode=buffer?buffer.from&&Uint8Array&&buffer.from!==Uint8Array.from?function(e){return(e.constructor===buffer.constructor?e:buffer.from(e,"base64")).toString()}:function(e){return(e.constructor===buffer.constructor?e:new buffer(e,"base64")).toString()}:function(e){return btou(_atob(e))},decode=function(e){return _decode(String(e).replace(/[-_]/g,function(e){return"-"==e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},noConflict=function(){var e=global.Base64;return global.Base64=_Base64,e};if(global.Base64={VERSION:version,atob:atob,btoa:btoa,fromBase64:decode,toBase64:encode,utob:utob,encode:encode,encodeURI:encodeURI,btou:btou,decode:decode,noConflict:noConflict,__buffer__:buffer},"function"===typeof Object.defineProperty){var noEnum=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}};global.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",noEnum(function(){return decode(this)})),Object.defineProperty(String.prototype,"toBase64",noEnum(function(e){return encode(this,e)})),Object.defineProperty(String.prototype,"toBase64URI",noEnum(function(){return encode(this,!0)}))}}return global["Meteor"]&&(Base64=global.Base64),module.exports?module.exports.Base64=global.Base64:(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return global.Base64}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)),{Base64:global.Base64}})}).call(this,__webpack_require__("c8ba"))},4758:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("Open")],1)},o=[],s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("h1",[e._v("目前开放的设备:")]),r("el-collapse",{on:{change:e.handleChange},model:{value:e.activeNames,callback:function(t){e.activeNames=t},expression:"activeNames"}},e._l(e.data,function(t,a,o){return r("el-collapse-item",{key:o,attrs:{title:a,name:o}},[r("div",[e._v("设备类型："+e._s(t.device_type))]),r("div",[e._v("\n        设备指令集：\n        "),r("el-tree",{staticClass:"filter-tree",attrs:{data:e.treeData[a],props:e.treeDefaultProps,"default-expand-all":""}}),r("br"),!0===e.data[a].write_permission?r("el-row",[r("el-col",[r("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择"},model:{value:e.selectCommand,callback:function(t){e.selectCommand=t},expression:"selectCommand"}},e._l(e.commands[a],function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1)],1):e._e(),r("br"),!0===e.data[a].write_permission?r("el-row",[r("el-col",{attrs:{span:16}},[""===e.selectCommand?r("el-input",{attrs:{placeholder:"请输入内容"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleCommand(a)}},model:{value:e.inputParams,callback:function(t){e.inputParams=t},expression:"inputParams"}}):r("el-input",{attrs:{placeholder:e.commands[a][e.selectCommand].params},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleCommand(a)}},model:{value:e.inputParams,callback:function(t){e.inputParams=t},expression:"inputParams"}})],1),r("el-col",{attrs:{span:8}},[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.handleCommand(a)}}},[e._v("\n              发送\n              "),r("i",{staticClass:"el-icon-upload el-icon--right"})])],1)],1):e._e()],1),r("br"),e.response[a]||e.imageBase64.length>0?r("div",[e._v("\n        设备回应：\n        "),e.response[a]?r("v-chart",{ref:"line",refInFor:!0,staticStyle:{width:"100%",height:"100%","min-width":"300px","min-height":"600px"},attrs:{options:e.chart_option(a),autoresize:""}}):e._e(),e._l(e.imageBase64,function(e,t){return r("img",{key:t,attrs:{src:"data:image/jpeg;base64,"+e}})})],2):e._e()])}),1)],1)},n=[],i=r("5c96"),c=r("58f3");let l=r("27ae").Base64;var d=1,u={name:"open",data(){return{error_count:0,imageBase64:[],activeNames:[],data:{},serial_list:[],intervalId:0,inputParams:"",commands:{},selectCommand:"",treeData:{},response:{},treeDefaultProps:{children:"children",label:"label"},chart_option_list:{},chart_option_template:{title:{text:"Try Dragging these Points"},tooltip:{formatter:function(e){return"X: "+e.data[0].toFixed(2)+"<br>Y: "+e.data[1].toFixed(2)}},grid:{},xAxis:{min:0,max:1,type:"value",axisLine:{onZero:!1}},yAxis:{min:-10,max:10,type:"value",axisLine:{onZero:!1}},dataZoom:[{type:"slider",xAxisIndex:0,filterMode:"empty"},{type:"slider",yAxisIndex:0,filterMode:"empty"},{type:"inside",xAxisIndex:0,filterMode:"empty"},{type:"inside",yAxisIndex:0,filterMode:"empty"}],series:[{type:"line",smooth:!0,symbolSize:d,data:[]}]}}},created(){this.getOpenDevice(),this.intervalId=setInterval(()=>{this.getOpenDevice()},1e3)},beforeDestroy(){clearInterval(this.intervalId)},watch:{$route(e,t){"openDevice"===e.name&&this.getOpenDevice()},data:function(e,t){this.deviceSetHandler(),this.responseHandler()}},methods:{handleCommand(e){this.$store.state.user.serial=e,console.log(this.commands[e]),console.log(this.selectCommand),this.$store.state.user.command={command:this.commands[e][this.selectCommand].label,params:this.inputParams.split(" ")},this.$store.dispatch("user/sendCommand").then(()=>{Object(i["Message"])({message:"成功发送指令",type:"success",duration:2e3})}).catch(()=>{Object(i["Message"])({message:"无法发送指令，用户身份可能已过期，请尝试重新登录",type:"error",duration:2e3})})},chart_option(e){return e in this.chart_option_list||(this.chart_option_list[e]=this.chart_option_template),this.response[e]&&(this.chart_option_list[e].series[0].data=this.response[e].vol_data,this.chart_option_list[e].xAxis.max=this.response[e].time_end,this.chart_option_list[e].yAxis.max=this.response[e].vol_max,this.chart_option_list[e].yAxis.min=this.response[e].vol_min),console.log(this.chart_option_list[e]),this.chart_option_list[e]},scienceToFloat(e){var t=e.split("e");if(t.length>1){parseFloat(t[0]);var r=parseFloat(t[1]);if(0==r)var a=parseFloat(t[0]);else a=Math.pow(parseFloat(t[0]),parseFloat(t[1]))}else a=parseFloat(e);return a},responseHandler(){for(var e in this.data)if(this.data[e].latest_response&&(!this.response[e]||this.response[e].id!=this.data[e].latest_response_id))if("采集波形"==this.data[e].latest_response_command.command){for(var t=this.scienceToFloat(this.data[e].latest_response.sample_time),r=this.scienceToFloat(this.data[e].latest_response.vol_max),a=this.scienceToFloat(this.data[e].latest_response.vol_min),o=l.decode(this.data[e].latest_response.vol_data.slice(2,-1)),s=[],n=-1/0,i=1/0,d=0;d<o.length;d++)o.charCodeAt(d)>n?n=o.charCodeAt(d):o.charCodeAt(d)<i&&(i=o.charCodeAt(d)),s.push([d*t,o.charCodeAt(d)]);var u=Object(c["b"])(Object(c["d"])(r,a),Object(c["d"])(n,i));s=s.map(function(e){return[e[0],Object(c["a"])(Object(c["c"])(Object(c["d"])(e[1],i),u),a)]}),this.response[e]={id:this.data[e].latest_response_id,command:"采集波形",vol_data:s,vol_max:r,vol_min:a,time_end:o.length*t},console.log(this.response[e])}else"重建"==this.data[e].latest_response_command.command?(this.imageBase64=[],this.imageBase64[0]=this.data[e].latest_response.frameL,this.imageBase64[1]=this.data[e].latest_response.frameR,this.imageBase64[2]=this.data[e].latest_response.reconstruction):"拍照"==this.data[e].latest_response_command.command&&(this.imageBase64=[],this.imageBase64[0]=this.data[e].latest_response.frameL,this.imageBase64[1]=this.data[e].latest_response.frameR)},deviceSetHandler(){for(var e in this.data)if(-1==this.serial_list.indexOf(e)){var t=[],r=[],a=1;for(var o in this.data[e].device_set){var s={label:"指令"+String(a)+"： "+o,children:[]},n=1,i="参数：";for(var c in this.data[e].device_set[o]){var l={label:"参数"+String(n)+"： "+c+"   取值类型及范围："+this.data[e].device_set[o][c]};s.children.push(l),i+=c+" ",n+=1}r.push({label:o,value:a-1,params:i}),t.push(s),a+=1}this.treeData[e]=t,this.commands[e]=r,this.serial_list.push(e)}return Promise.resolve()},getOpenDevice(){this.$store.dispatch("user/queryDevices").then(e=>{this.error_count=0,console.log(e),this.data=e}).catch(()=>{this.error_count+=1,console.log(this.error_count),this.error_count>3&&(Object(i["Message"])({message:"无法获取设备信息，用户身份可能已过期，请尝试重新登录",type:"error",duration:2e3}),this.error_count=0)})},handleChange(e){console.log(e)}}},h=u,p=(r("18eb"),r("2877")),m=Object(p["a"])(h,s,n,!1,null,"6a42a706",null),_=m.exports,f={name:"open",components:{Open:_}},b=f,v=Object(p["a"])(b,a,o,!1,null,null,null);t["default"]=v.exports},"4eb8":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("Watch")],1)},o=[],s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("router-view")],1)},n=[],i={name:"watch"},c=i,l=r("2877"),d=Object(l["a"])(c,s,n,!1,null,null,null),u=d.exports,h={name:"watch",components:{Watch:u}},p=h,m=Object(l["a"])(p,a,o,!1,null,null,null);t["default"]=m.exports},"58f3":function(e,t,r){"use strict";function a(e,t){var r,a,o;e=Number(e),t=Number(t);try{r=i(e)+1}catch(c){r=0}try{a=i(t)+1}catch(c){a=0}o=Math.pow(10,Math.max(r,a));var s=(n(e,o)+n(t,o))/o;return l("add",e,t,s)}function o(e,t){var r,a,o;e=Number(e),t=Number(t);try{r=i(e)+1}catch(c){r=0}try{a=i(t)+1}catch(c){a=0}o=Math.pow(10,Math.max(r,a));var s=Number((n(e,o)-n(t,o))/o);return l("sub",e,t,s)}function s(e,t){e=Number(e),t=Number(t);var r,a,o=0,s=0;try{o=i(e)}catch(u){}try{s=i(t)}catch(u){}r=c(e),a=c(t);var d=n(r/a,Math.pow(10,s-o));return l("div",e,t,d)}function n(e,t){e=Number(e),t=Number(t);var r=0,a=e.toString(),o=t.toString();try{r+=i(a)}catch(n){}try{r+=i(o)}catch(n){}var s=c(a)*c(o)/Math.pow(10,r);return l("mul",e,t,s)}r.d(t,"a",function(){return a}),r.d(t,"d",function(){return o}),r.d(t,"b",function(){return s}),r.d(t,"c",function(){return n});var i=function(e){var t=0;try{e=Number(e);var r=e.toString().toUpperCase();if(2===r.split("E").length){var a=!1;2===r.split(".").length&&(r=r.split(".")[1],0!==parseInt(r.split("E")[0])&&(a=!0));let e=r.split("E");a&&(t=e[0].length),t-=parseInt(e[1])}else 2===r.split(".").length&&0!==parseInt(r.split(".")[1])&&(t=r.split(".")[1].length)}catch(o){throw o}finally{return(isNaN(t)||t<0)&&(t=0),t}},c=function(e){e=Number(e);var t=e,r=i(e),a=e.toString().toUpperCase();return t=2===a.split("E").length?Math.round(e*Math.pow(10,r)):Number(a.replace(".","")),t},l=function(e,t,r,a){var o=0;switch(e){case"add":o=t+r;break;case"sub":o=t-r;break;case"div":o=t/r;break;case"mul":o=t*r;break}return Math.abs(a-o)>1?o:a}},c890:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("History")],1)},o=[],s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",[r("h1",[e._v("设备历史")]),r("el-row",[e._v("\n    请选择设备：\n    "),r("el-select",{attrs:{filterable:"",clearable:"",placeholder:"CPU序列号"},on:{change:e.selectDeviceChange},model:{value:e.selectDevice,callback:function(t){e.selectDevice=t},expression:"selectDevice"}},e._l(e.data,function(e,t,a){return r("el-option",{key:a,attrs:{label:t,value:t}})}),1)],1),r("br"),""!=e.selectDevice&&!0===e.data[e.selectDevice].read_permission?r("div",[r("el-row",[e._v("\n      请选择要查询的历史信息：\n      "),r("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",clearable:"",placeholder:"历史记录"},model:{value:e.selectHistory,callback:function(t){e.selectHistory=t},expression:"selectHistory"}},e._l(e.data[e.selectDevice].history,function(t,a,o){return r("el-option",{key:o,attrs:{label:e._f("historyFormatter")(t),value:t.id}})}),1)],1),r("br"),r("el-row",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.QueryHistoryDetail(e.selectHistory)}}},[e._v("\n        查询历史详情\n        "),r("i",{staticClass:"el-icon-upload el-icon--right"})])],1)],1):""!=e.selectDevice&&!1===e.data[e.selectDevice].read_permission?r("el-row",[r("h3",{staticStyle:{color:"red"}},[e._v("您没有权限查看此设备历史")])]):e._e(),r("br"),e.data[e.selectDevice]&&e.data[e.selectDevice].device_type.indexOf("image")>-1?r("div",[""!=e.history_response&&"重建"==e.history_response.command.command?r("el-row",[r("img",{attrs:{src:"data:image/jpeg;base64,"+e.history_response.response.frameL}}),r("img",{attrs:{src:"data:image/jpeg;base64,"+e.history_response.response.frameR}}),r("img",{attrs:{src:"data:image/jpeg;base64,"+e.history_response.response.reconstruction}})]):""!=e.history_response&&"拍照"==e.history_response.command.command?r("el-row",[r("img",{attrs:{src:"data:image/jpeg;base64,"+e.history_response.response.frameL}}),r("img",{attrs:{src:"data:image/jpeg;base64,"+e.history_response.response.frameR}})]):e._e()],1):e._e(),e.data[e.selectDevice]&&e.data[e.selectDevice].device_type.indexOf("wave")>-1?r("div",[""!=e.history_response&&"采集波形"==e.history_response.command.command?r("el-row",[e.history_response.response.vol_data?r("v-chart",{ref:"line",staticStyle:{width:"100%",height:"100%","min-width":"300px","min-height":"600px"},attrs:{options:e.chart,autoresize:""}}):e._e()],1):e._e()],1):e._e()],1)},n=[],i=r("5c96"),c=r("58f3");let l=r("27ae").Base64;var d=1,u={name:"history",data(){return{data:[],selectDevice:"",selectHistory:"",history_response:"",chart_option_template:{title:{text:"Try Dragging these Points"},tooltip:{formatter:function(e){return"X: "+e.data[0].toFixed(2)+"<br>Y: "+e.data[1].toFixed(2)}},grid:{},xAxis:{min:0,max:1,type:"value",axisLine:{onZero:!1}},yAxis:{min:-10,max:10,type:"value",axisLine:{onZero:!1}},dataZoom:[{type:"slider",xAxisIndex:0,filterMode:"empty"},{type:"slider",yAxisIndex:0,filterMode:"empty"},{type:"inside",xAxisIndex:0,filterMode:"empty"},{type:"inside",yAxisIndex:0,filterMode:"empty"}],series:[{type:"line",smooth:!0,symbolSize:d,data:[]}]}}},computed:{chart:function(){for(var e=this.scienceToFloat(this.history_response.response.sample_time),t=this.scienceToFloat(this.history_response.response.vol_max),r=this.scienceToFloat(this.history_response.response.vol_min),a=l.decode(this.history_response.response.vol_data.slice(2,-1)),o=[],s=-1/0,n=1/0,i=0;i<a.length;i++)a.charCodeAt(i)>s?s=a.charCodeAt(i):a.charCodeAt(i)<n&&(n=a.charCodeAt(i)),o.push([i*e,a.charCodeAt(i)]);var d=Object(c["b"])(Object(c["d"])(t,r),Object(c["d"])(s,n));return o=o.map(function(e){return[e[0],Object(c["a"])(Object(c["c"])(Object(c["d"])(e[1],n),d),r)]}),this.chart_option_template.series[0].data=o,this.chart_option_template.xAxis.max=a.length*e,this.chart_option_template.yAxis.min=r,this.chart_option_template}},filters:{historyFormatter(e){if(""!=e.command.params)var t=e.command.params;else t="无";var r=new Date(e.timestamp),a=r.getFullYear(),o=r.getMonth()+1,s=r.getDate(),n=r.getHours(),i=r.getMinutes(),c=r.getSeconds();return"时间："+a+"年"+o+"月"+s+"日"+n+"时"+i+"分"+c+"秒,指令："+e.command.command+",参数："+t}},created(){this.getDeviceHistory()},methods:{scienceToFloat(e){var t=e.split("e");if(t.length>1){parseFloat(t[0]);var r=parseFloat(t[1]);if(0==r)var a=parseFloat(t[0]);else a=Math.pow(parseFloat(t[0]),parseFloat(t[1]))}else a=parseFloat(e);return a},getDeviceHistory(){this.$store.dispatch("user/deviceHistory").then(e=>{console.log(e),this.data=e}).catch(()=>{Object(i["Message"])({message:"无法获取设备历史，用户身份可能已过期，请尝试重新登录",type:"error",duration:2e3})})},QueryHistoryDetail(e){this.$store.state.user.device_history_id=e,this.$store.dispatch("user/deviceHistoryDetail").then(e=>{console.log(e),this.history_response=e}).catch(()=>{Object(i["Message"])({message:"无法获取设备历史详情，用户身份可能已过期，请尝试重新登录",type:"error",duration:2e3})})},selectDeviceChange(){this.selectHistory=""}},watch:{$route(e,t){"deviceHistory"===e.name&&this.getDeviceHistory()}}},h=u,p=r("2877"),m=Object(p["a"])(h,s,n,!1,null,null,null),_=m.exports,f={name:"history",components:{History:_}},b=f,v=Object(p["a"])(b,a,o,!1,null,null,null);t["default"]=v.exports},c92b:function(e,t,r){}}]);
//# sourceMappingURL=WATCH.7fcc85d7.js.map